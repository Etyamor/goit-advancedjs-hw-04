{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport axios from 'axios';\n\nconst API_KEY = '48010442-005cbb84b5a65166ca3b031bb';\nconst API_URL = 'https://pixabay.com/api/';\n\naxios.defaults.baseURL = API_URL;\n\nconst fetchApiData = (queryValue, page, perPage) => {\n  const searchParams = new URLSearchParams({\n    key: API_KEY,\n    q: queryValue.trim(),\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    page: page,\n    per_page: perPage,\n  });\n\n  return axios.get(`https://pixabay.com/api/?${searchParams}`)\n    .then(response => {\n      if (response.status != 200) {\n        console.log(response);\n        iziToast.error({\n          message:\n            'Something went wrong. Please try again later',\n          position: 'topRight',\n        });\n        throw new Error(response.status);\n      }\n      console.log(typeof response);\n      console.log(response);\n      return response.data;\n    })\n    .then(data => {\n      if (!data.total) {\n        iziToast.error({\n          message:\n            'Sorry, there are no images matching your search query. Please try again!',\n          position: 'topRight',\n        });\n        return [];\n      }\n\n      return {\n        images: data.hits,\n        total: data.totalHits,\n      };\n    })\n    .catch(error => {\n      iziToast.error({\n        message:\n          'Something went wrong. Please try again later',\n        position: 'topRight',\n      });\n      console.log(error);\n      return [];\n    });\n};\n\nexport default fetchApiData;\n","const generateGalleryMarkup = images => {\n  return images.reduce(\n    (\n      acc,\n      { webformatURL, largeImageURL, tags, likes, views, comments, downloads }\n    ) => {\n      return (\n        acc +\n        `<li class=\"gallery-card\">\n              <a class=\"gallery-link\" href=\"${largeImageURL}\">\n                <img class=\"gallery-image\" src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" />\n                <ul class=\"gallery-card-info\">\n                  <li>\n                    <p>Likes</p>\n                    <p>${likes}</p>\n                  </li>\n                  <li>\n                    <p>Views</p>\n                    <p>${views}</p>\n                  </li>\n                  <li>\n                    <p>Comments</p>\n                    <p>${comments}</p>\n                  </li>\n                  <li>\n                    <p>Downloads</p>\n                    <p>${downloads}</p>\n                  </li>\n                </ul>\n              </a>\n            </li>`\n      );\n    },\n    ''\n  );\n};\n\nexport default generateGalleryMarkup;\n","import SimpleLightbox from 'simplelightbox';\nimport fetchApiData from './js/pixabay-api';\nimport generateGalleryMarkup from './js/render-functions';\nimport iziToast from 'izitoast';\n\nlet page = 1, lastQuery = '';\n\nconst perPage = 15,\n  loadMoreGap = 44,\n  formElement = document.querySelector('.js-form'),\n  loaderElement = document.querySelector('.js-loader'),\n  loadMoreBtn = document.querySelector('.load-more'),\n  galleryContainer = document.querySelector('.js-gallery'),\n  simpleLightboxInstance = new SimpleLightbox('.js-gallery a.gallery-link', {\n    captionDelay: 250,\n    overlayOpacity: 0.8,\n  }),\n  submitHandler = event => {\n    event.preventDefault();\n    if (lastQuery === query && page == 1) {\n      return;\n    }\n\n    loaderElement.style.display = 'flex';\n    var query = event.target.elements['user-query'].value;\n    lastQuery = query;\n    page = 1;\n\n    fetchApiData(query, page, perPage)\n      .then(response => {\n        if (response.length == 0) {\n          galleryContainer.innerHTML = '';\n          loadMoreBtn.style.display = 'none';\n          return;\n        }\n        let images = response.images;\n        galleryContainer.innerHTML = generateGalleryMarkup(images);\n        simpleLightboxInstance.refresh();\n        loadMoreBtn.style.display = (response.total > perPage) ? 'block' : 'none';\n      })\n      .finally(() => {\n        formElement.reset();\n        loaderElement.style.display = 'none';\n      });\n  },\n  loadMoreHandler = async () => {\n    page += 1;\n    loaderElement.style.display = 'flex';\n    fetchApiData(lastQuery, page, perPage)\n      .then(response => {\n        let images = response.images;\n        galleryContainer.insertAdjacentHTML('beforeend', generateGalleryMarkup(images));\n        simpleLightboxInstance.refresh();\n        let totalShownElements = page * perPage;\n        if (totalShownElements >= response.total) {\n          loadMoreBtn.style.display = 'none';\n          iziToast.info({\n            message:\n              \"We're sorry, but you've reached the end of search results.\",\n            position: 'topRight',\n          });\n        }\n      })\n      .finally(() => {\n        formElement.reset();\n        setTimeout(() => {\n          const galleryCards = document.querySelectorAll('.gallery-card');\n          const lastGalleryCard = galleryCards[galleryCards.length - 1];\n          const height = lastGalleryCard.offsetHeight;\n          loaderElement.style.display = 'none';\n          window.scrollBy({\n            top: height * 2 - loadMoreGap,\n            behavior: 'smooth',\n          });\n        }, 500);\n      });\n  }\n\nformElement.addEventListener('submit', submitHandler);\n\nloadMoreBtn.addEventListener('click', loadMoreHandler);\n"],"names":["API_KEY","API_URL","axios","fetchApiData","queryValue","page","perPage","searchParams","response","iziToast","data","error","generateGalleryMarkup","images","acc","webformatURL","largeImageURL","tags","likes","views","comments","downloads","lastQuery","loadMoreGap","formElement","loaderElement","loadMoreBtn","galleryContainer","simpleLightboxInstance","SimpleLightbox","submitHandler","event","query","loadMoreHandler","galleryCards","height"],"mappings":"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"}